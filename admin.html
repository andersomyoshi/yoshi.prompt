<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yoshi Prompts - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #8bc6f2, #a18dce); }
        .main-container { max-width: 500px; margin: 0 auto; }
        .btn-main.active { background-color: #22c55e; color: white; transform: scale(1.05); }
        .btn-sub.active, .btn-sub-prompt.active { background-color: #16a34a; color: white; }
        .page-content { background-color: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); }
        .history-box::-webkit-scrollbar { width: 5px; } .history-box::-webkit-scrollbar-track { background: transparent; } .history-box::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.3); border-radius: 10px; }
    </style>
</head>
<body class="text-gray-800">

    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4"></div>
    <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"></div>

    <div class="main-container min-h-screen p-4 flex flex-col">
        <header class="flex justify-between items-center mb-4 text-white">
            <h1 id="admin-name" class="text-3xl font-bold"></h1>
            <button onclick="window.location.href='index.html'" class="text-4xl transform hover:scale-110">&laquo;</button>
        </header>

        <div class="flex justify-around items-center mb-6 space-x-2">
            <button onclick="showPage('cadastrar')" data-page="cadastrar" class="btn-main flex-1 py-2 px-4 bg-lime-300 rounded-full shadow-md hover:bg-lime-400 font-semibold">Cadastrar</button>
            <button onclick="showPage('monitorar')" data-page="monitorar" class="btn-main flex-1 py-2 px-4 bg-lime-300 rounded-full shadow-md hover:bg-lime-400 font-semibold">Monitorar</button>
            <button onclick="showPage('adc-prompts')" data-page="adc-prompts" class="btn-main flex-1 py-2 px-4 bg-lime-300 rounded-full shadow-md hover:bg-lime-400 font-semibold active">Adc. Prompts</button>
        </div>

        <main class="flex-grow">
            <div id="monitorar-page" class="page-content rounded-2xl p-4 hidden">
                <h2 class="text-center font-bold text-white bg-black/20 rounded-full py-2 mb-4">HISTÓRICO DE ATIVIDADES GERAL</h2>
                <div id="global-history-log" class="history-box bg-white/80 p-4 rounded-lg h-96 overflow-y-auto text-sm space-y-2">Carregando logs...</div>
            </div>

            <div id="cadastrar-page" class="page-content rounded-2xl p-4 hidden"></div>

            <div id="adc-prompts-page" class="page-content rounded-2xl p-4"></div>
        </main>
        
        <footer class="text-center mt-6 text-white/70 text-sm">By: A.Yoshi</footer>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAg37Z0ahi-a_jNt_X89UUY1oj7RiNuMFs",
  authDomain: "yoshi-prompts-app.firebaseapp.com",
  projectId: "yoshi-prompts-app",
  storageBucket: "yoshi-prompts-app.firebasestorage.app",
  messagingSenderId: "509816669209",
  appId: "1:509816669209:web:695a6c4bd2d18014371688"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let allUsers = [];
        let allPrompts = [];
        let allLogs = [];

        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('admin-name').textContent = sessionStorage.getItem('username') || 'Admin';
            
            // Carrega todos os dados do Firebase
            await loadAllData();
            
            setupInitialPage(); // Configura a página inicial e os listeners
        });

        async function loadAllData() {
            try {
                // Carrega usuários
                const usersSnapshot = await db.collection('users').get();
                allUsers = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Carrega prompts
                const promptsSnapshot = await db.collection('prompts').get();
                allPrompts = promptsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // Carrega logs
                const logsSnapshot = await db.collection('activityLog').orderBy('timestamp', 'desc').get();
                allLogs = logsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            } catch (error) {
                console.error("Erro ao carregar dados do Firebase:", error);
                showNotification("Falha ao carregar dados. Verifique a conexão.");
            }
        }
        
        // --- FUNÇÕES DE NAVEGAÇÃO E LÓGICA DE UI ---
        // (As funções de navegação, modais e UI como showPage, showNotification, etc. permanecem as mesmas)
        // ... cole aqui as funções de UI do seu arquivo original ...
        
        // --- SEÇÃO DE USUÁRIOS ---
        async function saveCurrentUser() {
            const userId = document.getElementById('user-id').value;
            const userData = {
                name: document.getElementById('user-name').value.trim(),
                password: document.getElementById('user-password').value.trim(),
                login: document.getElementById('user-login').value.trim(),
                vencimento: document.getElementById('user-vencimento').value,
            };

            if (!userData.name || !userData.password || !userData.login) {
                showNotification("Preencha Nome, Senha e Login."); return;
            }

            try {
                if (userId) { // Atualiza usuário existente
                    await db.collection('users').doc(userId).update(userData);
                } else { // Cria novo usuário
                    const docRef = await db.collection('users').add(userData);
                    document.getElementById('user-id').value = docRef.id; // Atualiza o ID no formulário
                }
                showNotification('Usuário salvo com sucesso!');
                await loadAllData(); // Recarrega os dados
                renderUsers(); // Re-renderiza a lista de usuários
            } catch (error) {
                console.error("Erro ao salvar usuário:", error);
                showNotification("Erro ao salvar usuário.");
            }
        }

        async function deleteCurrentUser() {
            const userId = document.getElementById('user-id').value;
            if (!userId) { showNotification("Nenhum usuário selecionado."); return; }
            const userName = document.getElementById('user-name').value;
            
            showConfirm(`Deseja realmente excluir "${userName}"?`, async () => {
                try {
                    await db.collection('users').doc(userId).delete();
                    showNotification(`Usuário "${userName}" excluído!`);
                    await loadAllData();
                    newUser();
                    renderUsers();
                } catch (error) {
                    console.error("Erro ao excluir usuário:", error);
                    showNotification("Erro ao excluir usuário.");
                }
            });
        }
        
        // --- SEÇÃO DE PROMPTS ---
        async function saveCurrentPrompt() {
            const promptId = document.getElementById('prompt-id').value;
            const promptData = {
                marca_ia: document.getElementById('prompt-marca-ia').value.trim(),
                category: document.getElementById('prompt-category').value.trim(),
                description: document.getElementById('prompt-description').value.trim(),
                link: document.getElementById('prompt-link').value.trim(),
                text: document.getElementById('prompt-text').value.trim(),
                image: document.getElementById('prompt-image-preview').src,
            };

            if (!promptData.description || !promptData.category || !promptData.marca_ia) {
                showNotification("Preencha Descrição, Categoria e Marca IA."); return;
            }
            
            try {
                if (promptId) {
                    await db.collection('prompts').doc(promptId).update(promptData);
                } else {
                    const docRef = await db.collection('prompts').add(promptData);
                    document.getElementById('prompt-id').value = docRef.id;
                }
                showNotification('Prompt salvo com sucesso!');
                await loadAllData();
                renderPrompts();
            } catch (error) {
                console.error("Erro ao salvar prompt:", error);
                showNotification("Erro ao salvar prompt.");
            }
        }

        async function deleteCurrentPrompt() {
            const promptId = document.getElementById('prompt-id').value;
            if (!promptId) { showNotification("Nenhum prompt selecionado."); return; }
            const promptDesc = document.getElementById('prompt-description').value;

            showConfirm(`Deseja excluir o prompt "${promptDesc}"?`, async () => {
                try {
                    await db.collection('prompts').doc(promptId).delete();
                    showNotification(`Prompt "${promptDesc}" excluído!`);
                    await loadAllData();
                    newPrompt();
                    renderPrompts();
                } catch (error) {
                    console.error("Erro ao excluir prompt:", error);
                    showNotification("Erro ao excluir prompt.");
                }
            });
        }
        
        // ... Cole o resto do seu script aqui, adaptando as funções de renderização para usar as variáveis globais (allUsers, allPrompts, allLogs) ...
        // Por exemplo, a função renderGlobalActivityLog agora usará 'allLogs' em vez de 'activityLog'.
    </script>
</body>
</html>
